-- =============================================
-- AM BOT v·ªõi ESP v√† 2 ch·∫ø ƒë·ªô AIM
-- =============================================

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local camera = Workspace.CurrentCamera

-- Bi·∫øn to√†n c·ª•c
local isAIM1 = false
local isAIM2 = false
local isESP = false
local connectionAIM1, connectionAIM2, connectionESP = nil, nil, nil
local espBoxes = {}
local lastTarget = nil

-- ================== GIAO DI·ªÜN ==================
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AmbotGUI"
screenGui.Parent = game:GetService("CoreGui") or player.PlayerGui

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 200, 0, 200)
mainFrame.Position = UDim2.new(0, 20, 0, 20)
mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
mainFrame.BorderSizePixel = 2
mainFrame.BorderColor3 = Color3.fromRGB(80, 80, 120)
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = screenGui

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 30)
title.Position = UDim2.new(0, 0, 0, 0)
title.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
title.TextColor3 = Color3.fromRGB(255, 100, 100)
title.Text = "üî• AM BOT PRO üî•"
title.Font = Enum.Font.SourceSansBold
title.TextSize = 18
title.Parent = mainFrame

-- N√∫t AIM MODE 1
local aim1Button = Instance.new("TextButton")
aim1Button.Size = UDim2.new(0.9, 0, 0, 35)
aim1Button.Position = UDim2.new(0.05, 0, 0.18, 0)
aim1Button.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
aim1Button.TextColor3 = Color3.fromRGB(255, 255, 255)
aim1Button.Text = "üéØ AIM MODE 1: OFF"
aim1Button.Font = Enum.Font.SourceSansBold
aim1Button.TextSize = 14
aim1Button.Parent = mainFrame

-- N√∫t AIM MODE 2
local aim2Button = Instance.new("TextButton")
aim2Button.Size = UDim2.new(0.9, 0, 0, 35)
aim2Button.Position = UDim2.new(0.05, 0, 0.4, 0)
aim2Button.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
aim2Button.TextColor3 = Color3.fromRGB(255, 255, 255)
aim2Button.Text = "üéØ AIM MODE 2: OFF"
aim2Button.Font = Enum.Font.SourceSansBold
aim2Button.TextSize = 14
aim2Button.Parent = mainFrame

-- N√∫t ESP
local espButton = Instance.new("TextButton")
espButton.Size = UDim2.new(0.9, 0, 0, 35)
espButton.Position = UDim2.new(0.05, 0, 0.62, 0)
espButton.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
espButton.TextColor3 = Color3.fromRGB(255, 255, 255)
espButton.Text = "üì° ESP: OFF"
espButton.Font = Enum.Font.SourceSansBold
espButton.TextSize = 14
espButton.Parent = mainFrame

-- Status label
local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(0.9, 0, 0, 25)
statusLabel.Position = UDim2.new(0.05, 0, 0.84, 0)
statusLabel.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
statusLabel.Text = "READY"
statusLabel.Font = Enum.Font.SourceSans
statusLabel.TextSize = 12
statusLabel.Parent = mainFrame

-- ================== H√ÄM T√åM NG∆Ø·ªúI CH∆†I ==================
function findNearestPlayer()
    local nearestPlayer = nil
    local nearestDistance = math.huge
    local localCharacter = player.Character
    local localRoot = localCharacter and localCharacter:FindFirstChild("HumanoidRootPart")
    
    if not localRoot then return nil end
    
    for _, otherPlayer in pairs(Players:GetPlayers()) do
        if otherPlayer ~= player and otherPlayer.Character then
            local otherRoot = otherPlayer.Character:FindFirstChild("HumanoidRootPart")
            if otherRoot then
                local distance = (localRoot.Position - otherRoot.Position).Magnitude
                if distance < nearestDistance then
                    nearestDistance = distance
                    nearestPlayer = otherPlayer
                end
            end
        end
    end
    
    lastTarget = nearestPlayer
    return nearestPlayer, nearestDistance
end

-- ================== ESP SYSTEM ==================
function createESPBox(targetPlayer)
    if not targetPlayer or not targetPlayer.Character then return end
    
    local character = targetPlayer.Character
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid then return end
    
    -- T·∫°o ESP box
    local espBox = Instance.new("BillboardGui")
    espBox.Name = "ESP_" .. targetPlayer.Name
    espBox.Size = UDim2.new(5, 0, 7, 0)
    espBox.AlwaysOnTop = true
    espBox.ClipsDescendants = true
    
    local espFrame = Instance.new("Frame")
    espFrame.Size = UDim2.new(1, 0, 1, 0)
    espFrame.BackgroundTransparency = 0.7
    espFrame.BorderSizePixel = 2
    espFrame.BorderColor3 = Color3.fromRGB(255, 50, 50)
    espFrame.BackgroundColor3 = Color3.fromRGB(255, 50, 50, 0.1)
    espFrame.Parent = espBox
    
    local espName = Instance.new("TextLabel")
    espName.Size = UDim2.new(1, 0, 0.2, 0)
    espName.Position = UDim2.new(0, 0, -0.3, 0)
    espName.BackgroundTransparency = 1
    espName.TextColor3 = Color3.fromRGB(255, 100, 100)
    espName.Text = targetPlayer.Name
    espName.Font = Enum.Font.SourceSansBold
    espName.TextSize = 14
    espName.Parent = espBox
    
    local espHealth = Instance.new("TextLabel")
    espHealth.Size = UDim2.new(1, 0, 0.2, 0)
    espHealth.Position = UDim2.new(0, 0, 1, 0)
    espHealth.BackgroundTransparency = 1
    espHealth.TextColor3 = Color3.fromRGB(100, 255, 100)
    espHealth.Font = Enum.Font.SourceSans
    espHealth.TextSize = 12
    espHealth.Parent = espBox
    
    -- G·∫Øn v√†o HumanoidRootPart
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    if rootPart then
        espBox.Adornee = rootPart
        espBox.Parent = rootPart
    else
        espBox.Adornee = humanoid
        espBox.Parent = character
    end
    
    espBoxes[targetPlayer] = espBox
    
    -- C·∫≠p nh·∫≠t health
    connectionESP = RunService.RenderStepped:Connect(function()
        if espBox and espBox.Parent then
            espHealth.Text = "HP: " .. math.floor(humanoid.Health) .. "/" .. math.floor(humanoid.MaxHealth)
            
            -- ƒê·ªïi m√†u theo health
            local healthPercent = humanoid.Health / humanoid.MaxHealth
            if healthPercent > 0.7 then
                espFrame.BorderColor3 = Color3.fromRGB(100, 255, 100)
            elseif healthPercent > 0.3 then
                espFrame.BorderColor3 = Color3.fromRGB(255, 255, 100)
            else
                espFrame.BorderColor3 = Color3.fromRGB(255, 50, 50)
            end
        end
    end)
end

function removeESP()
    for targetPlayer, espBox in pairs(espBoxes) do
        if espBox then
            espBox:Destroy()
        end
    end
    espBoxes = {}
    
    if connectionESP then
        connectionESP:Disconnect()
        connectionESP = nil
    end
end

function updateESP()
    removeESP()
    
    for _, otherPlayer in pairs(Players:GetPlayers()) do
        if otherPlayer ~= player and otherPlayer.Character then
            createESPBox(otherPlayer)
        end
    end
end

-- ================== AIM MODE 1 ==================
-- Quay c·∫£ camera v√† m√†n h√¨nh, t√¢m h∆∞·ªõng th·∫≥ng v√†o player
function startAIM1()
    connectionAIM1 = RunService.RenderStepped:Connect(function()
        local nearestPlayer = findNearestPlayer()
        if nearestPlayer and nearestPlayer.Character then
            local targetHead = nearestPlayer.Character:FindFirstChild("Head")
            local targetRoot = nearestPlayer.Character:FindFirstChild("HumanoidRootPart")
            
            if not targetHead and not targetRoot then return end
            
            local targetPosition = targetHead and targetHead.Position or targetRoot.Position
            
            -- Quay camera
            if camera then
                local direction = (targetPosition - camera.CFrame.Position).Unit
                local newCFrame = CFrame.new(camera.CFrame.Position, camera.CFrame.Position + direction)
                camera.CFrame = newCFrame
            end
            
            -- Quay character
            local localCharacter = player.Character
            local localRoot = localCharacter and localCharacter:FindFirstChild("HumanoidRootPart")
            
            if localRoot then
                local characterDirection = (targetPosition - localRoot.Position).Unit
                local characterCFrame = CFrame.new(localRoot.Position, localRoot.Position + characterDirection)
                localRoot.CFrame = characterCFrame
            end
            
            -- Update status
            local distance = (localRoot.Position - targetPosition).Magnitude
            statusLabel.Text = string.format("AIM1: %s (%.1f studs)", nearestPlayer.Name, distance)
        end
    end)
end

-- ================== AIM MODE 2 ==================
-- Click v√†o b·∫•t c·ª© ƒë√¢u c≈©ng b·∫Øn v√†o player g·∫ßn nh·∫•t
function startAIM2()
    local mouse = player:GetMouse()
    
    -- Override mouse click
    connectionAIM2 = RunService.RenderStepped:Connect(function()
        local nearestPlayer = findNearestPlayer()
        if nearestPlayer and nearestPlayer.Character then
            local targetHead = nearestPlayer.Character:FindFirstChild("Head")
            local targetRoot = nearestPlayer.Character:FindFirstChild("HumanoidRootPart")
            
            if not targetHead and not targetRoot then return end
            
            local targetPosition = targetHead and targetHead.Position or targetRoot.Position
            
            -- Ki·ªÉm tra n·∫øu ƒëang click chu·ªôt
            if UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) then
                -- T√≠nh to√°n ray t·ª´ camera ƒë·∫øn target
                local camera = Workspace.CurrentCamera
                local direction = (targetPosition - camera.CFrame.Position).Unit
                
                -- T·∫°o raycast
                local ray = Ray.new(camera.CFrame.Position, direction * 1000)
                local hitPart, hitPosition = Workspace:FindPartOnRayWithIgnoreList(ray, {player.Character})
                
                if hitPart then
                    -- T√¨m player t·ª´ hit part
                    local hitPlayer = game:GetService("Players"):GetPlayerFromCharacter(hitPart.Parent)
                    
                    if hitPlayer == nearestPlayer then
                        -- Fire hit event (n·∫øu c√≥)
                        pcall(function()
                            -- C√°c game th∆∞·ªùng c√≥ RemoteEvent ƒë·ªÉ b·∫Øn
                            local remotes = game:GetService("ReplicatedStorage"):GetChildren()
                            for _, remote in pairs(remotes) do
                                if remote:IsA("RemoteEvent") and 
                                   (remote.Name:lower():find("hit") or 
                                    remote.Name:lower():find("damage") or
                                    remote.Name:lower():find("shoot")) then
                                    remote:FireServer({
                                        target = nearestPlayer.Character.Humanoid,
                                        damage = 10,
                                        part = hitPart
                                    })
                                end
                            end
                        end)
                    end
                end
                
                -- Update status
                local localCharacter = player.Character
                local localRoot = localCharacter and localCharacter:FindFirstChild("HumanoidRootPart")
                if localRoot then
                    local distance = (localRoot.Position - targetPosition).Magnitude
                    statusLabel.Text = string.format("AIM2: %s (%.1f studs)", nearestPlayer.Name, distance)
                end
            end
        end
    end)
    
    -- Override mouse position ƒë·ªÉ lu√¥n target v√†o player
    local originalMouseTarget
    originalMouseTarget = hookfunction(mouse.Target, function()
        local nearestPlayer = findNearestPlayer()
        if nearestPlayer and nearestPlayer.Character then
            local targetHead = nearestPlayer.Character:FindFirstChild("Head")
            return targetHead or nearestPlayer.Character:FindFirstChild("HumanoidRootPart")
        end
        return originalMouseTarget()
    end)
end

-- ================== TOGGLE FUNCTIONS ==================
function toggleAIM1()
    isAIM1 = not isAIM1
    
    if isAIM1 then
        -- T·∫Øt AIM2 n·∫øu ƒëang b·∫≠t
        if isAIM2 then toggleAIM2() end
        
        aim1Button.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
        aim1Button.Text = "üéØ AIM MODE 1: ON"
        startAIM1()
    else
        aim1Button.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
        aim1Button.Text = "üéØ AIM MODE 1: OFF"
        
        if connectionAIM1 then
            connectionAIM1:Disconnect()
            connectionAIM1 = nil
        end
        statusLabel.Text = "READY"
    end
end

function toggleAIM2()
    isAIM2 = not isAIM2
    
    if isAIM2 then
        -- T·∫Øt AIM1 n·∫øu ƒëang b·∫≠t
        if isAIM1 then toggleAIM1() end
        
        aim2Button.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
        aim2Button.Text = "üéØ AIM MODE 2: ON"
        startAIM2()
    else
        aim2Button.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
        aim2Button.Text = "üéØ AIM MODE 2: OFF"
        
        if connectionAIM2 then
            connectionAIM2:Disconnect()
            connectionAIM2 = nil
        end
        statusLabel.Text = "READY"
    end
end

function toggleESP()
    isESP = not isESP
    
    if isESP then
        espButton.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
        espButton.Text = "üì° ESP: ON"
        updateESP()
    else
        espButton.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
        espButton.Text = "üì° ESP: OFF"
        removeESP()
    end
end

-- ================== SETUP UI ==================
aim1Button.MouseButton1Click:Connect(toggleAIM1)
aim2Button.MouseButton1Click:Connect(toggleAIM2)
espButton.MouseButton1Click:Connect(toggleESP)

-- Hi·ªáu ·ª©ng hover
local function setupButtonHover(button)
    button.MouseEnter:Connect(function()
        if button.BackgroundColor3 ~= Color3.fromRGB(0, 150, 0) and 
           button.BackgroundColor3 ~= Color3.fromRGB(150, 0, 0) and
           button.BackgroundColor3 ~= Color3.fromRGB(0, 100, 200) then
            button.BackgroundColor3 = Color3.fromRGB(80, 80, 100)
        end
    end)
    
    button.MouseLeave:Connect(function()
        if button == aim1Button then
            button.BackgroundColor3 = isAIM1 and Color3.fromRGB(0, 150, 0) or Color3.fromRGB(60, 60, 80)
        elseif button == aim2Button then
            button.BackgroundColor3 = isAIM2 and Color3.fromRGB(150, 0, 0) or Color3.fromRGB(60, 60, 80)
        elseif button == espButton then
            button.BackgroundColor3 = isESP and Color3.fromRGB(0, 100, 200) or Color3.fromRGB(60, 60, 80)
        end
    end)
end

setupButtonHover(aim1Button)
setupButtonHover(aim2Button)
setupButtonHover(espButton)

-- Hotkeys
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed then
        if input.KeyCode == Enum.KeyCode.F1 then
            toggleAIM1()
        elseif input.KeyCode == Enum.KeyCode.F2 then
            toggleAIM2()
        elseif input.KeyCode == Enum.KeyCode.F3 then
            toggleESP()
        end
    end
end)

-- Auto update ESP khi c√≥ ng∆∞·ªùi ch∆°i m·ªõi
Players.PlayerAdded:Connect(function(newPlayer)
    if isESP then
        task.wait(1) -- ƒê·ª£i character load
        updateESP()
    end
end)

Players.PlayerRemoving:Connect(function(leavingPlayer)
    if espBoxes[leavingPlayer] then
        espBoxes[leavingPlayer]:Destroy()
        espBoxes[leavingPlayer] = nil
    end
end)

-- ================== KH·ªûI ƒê·ªòNG ==================
print("=========================================")
print("üî• AM BOT PRO LOADED üî•")
print("=========================================")
print("üéØ AIM MODE 1: Quay c·∫£ camera v√† character")
print("üéØ AIM MODE 2: Click ƒë√¢u c≈©ng b·∫Øn v√†o target")
print("üì° ESP: Hi·ªÉn th·ªã box v√† th√¥ng tin player")
print("")
print("Hotkeys:")
print("F1: Toggle AIM MODE 1")
print("F2: Toggle AIM MODE 2")
print("F3: Toggle ESP")
print("=========================================")